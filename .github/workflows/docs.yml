name: PUBLISH DOCS
on:
  workflow_dispatch:
  workflow_run:
    workflows: ["RELEASE AND PUBLISH"]
    types:
      - completed
  # or set up your own custom triggers
permissions:
  contents: write # allows the 'Deploy' step without tokens

jobs:
  get_history: # create an artifact from the existing documentation builds
    runs-on: ubuntu-latest
    steps:

    - name: get the gh-pages repo
      uses: actions/checkout@v3
      with:
        ref: gh-pages

    - name: tar the existing docs
      run: tar -cvf documentation.tar ./docs

    - name: create a document artifact
      uses: actions/upload-artifact@v3
      with:
        name: documentation
        path: documentation.tar

  build:
    needs: get_history
    runs-on: ubuntu-latest
    steps:

      - name: Checkout src # checks out the source code into the active workspace
        uses: actions/checkout@v3

      - run: mkdir -p ./docs
      - name: Download the existing documents artifact # retrieves and un-archives the existing documents
        uses: actions/download-artifact@v3
        with:
          name: documentation
      - run: tar -xf documentation.tar ./docs -C ./docs

      - name: Build
        uses: actions/setup-node@v3
        with:
          node-version: 16.x
          cache: 'npm'
      - run: npm ci # installs npm packages
      - run: npm run build # set up 'build' script in your package.json

      - name: Build documents
        run: npm run docs #set up 'docs' build script in your package.json

      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs          # take the 'docs' folder in the current workspace
          target-folder: docs   # and put it's content in the 'docs' folder of gh-pages 